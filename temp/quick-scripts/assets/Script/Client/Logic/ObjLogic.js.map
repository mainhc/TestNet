{"version":3,"sources":["ObjLogic.js"],"names":["cMoveAi","require","MoveAi","ObjLogic","cc","Class","properties","m_iObjId","m_Pos","Vec2","m_GridOldIndex","m_Hp","m_MaxHp","m_Dir","m_fDir","m_iSpeed","m_pMoveAi","m_objState","initLogicObj","objid","pos","charConfig","isSelf","currentHp","maxHp","initMoveAi","tempint","parseInt","Math","random","iDir","fdirhudu","PI","getLogicPos","getObjState","returnDir","huduToDir","fdir","jiaodu","updateTurnDir","updateState","iState","updataLogicObj","dt","updateMoveAi","x","GameObjMgr","getMapPixWidth","y","getMapPixHeight","gridIndex","pixToIndex","ObjChangeGrid","module","exports"],"mappings":"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","file":"ObjLogic.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Client\\Logic","sourcesContent":["//角色方向\r\n//    2\r\n//    |—— 0\r\n//    一格64像素  \r\n\r\nvar cMoveAi = require(\"MoveAi\").MoveAi;\r\n\r\nvar ObjLogic = cc.Class({\r\n\r\n     properties: {\r\n         m_iObjId:0,\r\n         m_Pos:cc.Vec2(0,0),\r\n         m_GridOldIndex:0,\r\n         m_Hp:0,\r\n         m_MaxHp:0,\r\n         m_Dir:0, //8方向\r\n         m_fDir:0,//具体真实的弧度 \r\n         m_iSpeed:3,\r\n         m_pMoveAi:null,\r\n         m_objState:0,\r\n     },\r\n\r\n     initLogicObj(objid,pos,charConfig,isSelf)\r\n     {\r\n         this.m_iObjId = objid;\r\n         this.m_Pos = pos;\r\n         this.m_Hp = charConfig.currentHp;\r\n         this.m_MaxHp =  charConfig.maxHp;\r\n        // if(isSelf != true)\r\n         {\r\n            this.m_pMoveAi = new cMoveAi;\r\n            this.m_pMoveAi.initMoveAi(this);\r\n         }        \r\n         var tempint = parseInt(100*Math.random());\r\n         var iDir = tempint%8;\r\n         this.m_Dir = iDir;\r\n         var fdirhudu = 45 * iDir/180 * Math.PI;         \r\n         this.m_fDir = fdirhudu;\r\n     },\r\n\r\n     getLogicPos()\r\n     {\r\n         return this.m_Pos;\r\n     },\r\n\r\n     getObjState()\r\n     {\r\n         return this.m_objState;\r\n     },\r\n\r\n     returnDir()\r\n     {\r\n         //this.m_Dir = (this.m_Dir + 4)%8;\r\n         var tempint = parseInt(100*Math.random());\r\n         this.m_Dir  = tempint%8;\r\n         var fdirhudu = 45 * this.m_Dir/180 * Math.PI;         \r\n         this.m_fDir = fdirhudu;\r\n\r\n     },\r\n\r\n     huduToDir(fdir)\r\n     {\r\n         var jiaodu = fdir/Math.PI * 180;\r\n         if(jiaodu>=-22.5 && jiaodu<22.5)\r\n         {\r\n             return 0;\r\n         }\r\n         else if(jiaodu>=22.5 && jiaodu<22.5*3)\r\n         {\r\n             return 1;\r\n         }\r\n         else if(jiaodu>=22.5*3 && jiaodu<22.5*5)\r\n         {\r\n             return 2;\r\n         }\r\n         else if(jiaodu>=22.5*5 && jiaodu<22.5*7)\r\n         {\r\n             return 3;\r\n         }\r\n         else if(jiaodu>=22.5*7 && jiaodu<22.5*8)\r\n         {\r\n             return 4;\r\n         }\r\n         else if(jiaodu>=-22.5*8 && jiaodu<-22.5*7)\r\n         {\r\n             return 4;\r\n         }\r\n         else if(jiaodu>=-22.5*7 && jiaodu<-22.5*5)\r\n         {\r\n             return 5;\r\n         }\r\n         else if(jiaodu>=-22.5*5 && jiaodu<-22.5*3)\r\n         {\r\n             return 6;\r\n         }\r\n        else if(jiaodu>=-22.5*3 && jiaodu<-22.5)\r\n         {\r\n             return 7;\r\n         }\r\n         else\r\n         {\r\n             return 0;\r\n         }\r\n     },\r\n\r\n     updateTurnDir(fdir)\r\n     {\r\n         this.m_fDir = fdir;\r\n         this.m_Dir =  this.huduToDir(fdir);\r\n     },\r\n\r\n     updateState(iState)\r\n     {\r\n         this.m_objState = iState;\r\n     },\r\n\r\n     updataLogicObj(dt)\r\n     {\r\n         if( this.m_pMoveAi != null)\r\n         {\r\n             this.m_pMoveAi.updateMoveAi(dt);\r\n         }\r\n         if(this.m_Pos.x <10 || this.m_Pos.x>=cc.GameObjMgr.getMapPixWidth()-10)\r\n         {\r\n             this.returnDir();\r\n         }\r\n         else if(this.m_Pos.y <10 || this.m_Pos.y>=cc.GameObjMgr.getMapPixHeight()-10)\r\n         {\r\n              this.returnDir();\r\n         }\r\n         var gridIndex = cc.GameObjMgr.pixToIndex(this.m_Pos);\r\n         if(gridIndex != this.m_GridOldIndex)\r\n         {\r\n             cc.GameObjMgr.ObjChangeGrid(this.m_iObjId,this.m_GridOldIndex,gridIndex);\r\n             this.m_GridOldIndex = gridIndex;\r\n         }\r\n     },     \r\n   \r\n});\r\n\r\n\r\nmodule.exports = {ObjLogic};\r\n"]}