{"version":3,"sources":["ObjView.js"],"names":["ObjLogic","require","eObjState","ObjView","cc","Class","extends","Node","properties","m_iObjId","m_objlogic","m_pAni","initObj","iobjId","model","objlogic","viewObj","instantiate","name","addChild","pAni","getComponent","Animation","play","getObjActionName","eState","iDir","strAction","eObjWalk","eObjStand","isNeedFanZhuan","updateObjView","dt","updataLogicObj","pOpt","getLogicPos","setPosition","updateAction","getObjState","m_Dir","strActionName","isFanzhan","anistatetemp","getAnimationState","isPlaying","rotationY","toTurn","fDir","updateTurnDir","setState","iState","updateState","module","exports"],"mappings":"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","file":"ObjView.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Client\\GameObjView","sourcesContent":["const ObjLogic = require(\"ObjLogic\").ObjLogic;\r\nvar eObjState = require(\"ClientDef\").eObjState;\r\n\r\nvar ObjView = cc.Class({\r\n    extends: cc.Node,\r\n\r\n    properties: {\r\n       m_iObjId:0, \r\n       m_objlogic:null,\r\n       m_pAni:null,\r\n      \r\n    },\r\n\r\n    initObj(iobjId,model,objlogic){\r\n\r\n        this.m_iObjId = iobjId;\r\n        this.m_objlogic = objlogic;\r\n        var viewObj = cc.instantiate(model);\r\n        viewObj.name = \"ObjBody\";\r\n        this.addChild(viewObj);\r\n        var pAni = viewObj.getComponent(cc.Animation);\r\n        if(pAni != null)\r\n        {\r\n            pAni.play(\"stand_c\");\r\n            this.m_pAni = pAni;\r\n\r\n        } \r\n    },\r\n    getObjActionName(eState,iDir)\r\n    {\r\n        var strAction = \"\";\r\n        switch(eState)\r\n        {\r\n            case eObjState.eObjWalk:\r\n            {\r\n                strAction = \"walk_\";\r\n                break;\r\n            }\r\n            case eObjState.eObjStand:\r\n            {\r\n                strAction = \"stand_\";\r\n                break;\r\n            }\r\n            default:\r\n            {\r\n                break;\r\n            }\r\n        }\r\n        if(iDir ==0 || iDir==4)\r\n        {\r\n            strAction += \"b\";\r\n        }\r\n        else if(iDir==1 || iDir==2 || iDir==3)\r\n        {\r\n            strAction += \"a\";\r\n        }\r\n        else\r\n        {\r\n            strAction += \"c\";\r\n        }\r\n        return strAction;\r\n    },\r\n\r\n    isNeedFanZhuan(iDir)\r\n    {\r\n        if(iDir > 2 &&  iDir<6)\r\n        {\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    updateObjView(dt)\r\n    {\r\n        if(this.m_objlogic != null)\r\n        {\r\n            this.m_objlogic.updataLogicObj(dt);\r\n            var pOpt = this.m_objlogic.getLogicPos();\r\n            this.setPosition(pOpt);\r\n        }\r\n        this.updateAction();\r\n    },\r\n\r\n    updateAction()\r\n    {\r\n        var eState = this.m_objlogic.getObjState();\r\n        var iDir = this.m_objlogic.m_Dir;\r\n        var strActionName = this.getObjActionName(eState,iDir); \r\n        var isFanzhan = this.isNeedFanZhuan(iDir);       \r\n        var anistatetemp = this.m_pAni.getAnimationState(strActionName); \r\n        if(anistatetemp==null)\r\n        {\r\n            this.m_pAni.play(strActionName);\r\n        }\r\n        else\r\n        {\r\n            if(!anistatetemp.isPlaying)\r\n            {\r\n                this.m_pAni.play(strActionName);\r\n            }\r\n        }\r\n\r\n        if(isFanzhan)\r\n        {\r\n            this.rotationY = 180;\r\n            //this.setScale(cc.v2(-1, 1));\r\n        }\r\n        else\r\n        {\r\n            this.rotationY = 0;\r\n            //this.setScale(cc.v2(1, 1));\r\n        }\r\n\r\n    },\r\n\r\n    toTurn(fDir)\r\n    {\r\n        this.m_objlogic.updateTurnDir(fDir);\r\n    },\r\n\r\n    setState(iState)\r\n    {\r\n        this.m_objlogic.updateState(iState);\r\n    },\r\n});\r\n\r\nmodule.exports = {ObjView};\r\n"]}