{"version":3,"sources":["Stick.js"],"names":["eObjState","require","cc","Class","extends","Component","properties","m_pMyBojView","stickBGR","stickBGPosition","Vec2","m_pArrow","pStickCenter","m_fAngle","m_fOldAngle","start","pStickBg","node","getChildByName","active","width","on","Node","EventType","TOUCH_START","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded","TOUCH_CANCEL","onTouchCancelled","p","GameObjMgr","getMyObjView","getAnglePosition","r","angle","Math","cos","sin","event","touchPos","convertToNodeSpaceAR","getLocation","pvecDes","pSub","pToAngle","dist","x","y","rad","setPosition","pAdd","log","updateArrow","eState","m_objlogic","m_objState","eObjWalk","pMSg","MsgMgr","CreateMsgByID","objLogicID","m_iObjId","ObjState","sendMsgToServer","stopAllActions","runAction","moveTo","eObjStand","rotation","PI","update","dt","nowAngle","toFixed","fDir"],"mappings":"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","file":"Stick.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Client\\GUI","sourcesContent":["var eObjState = require(\"ClientDef\").eObjState;\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        m_pMyBojView:null,\r\n        stickBGR:0,   \r\n        stickBGPosition:cc.Vec2(0,0),\r\n        m_pArrow:null,\r\n        pStickCenter:null,\r\n        m_fAngle:0,    \r\n        m_fOldAngle:0,\r\n    },\r\n\r\n    start () {\r\n        var pStickBg = this.node;\r\n        this.m_pArrow = pStickBg.getChildByName(\"StickArrow\");\r\n        this.m_pArrow.active = false;\r\n        this.pStickCenter = pStickBg.getChildByName(\"StickCenter\");\r\n        this.stickBGR = pStickBg.width * 0.5;\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END, this.onTouchEnded,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancelled,this);\r\n        this.stickBGPosition = cc.p(0,0);\r\n        this.m_pMyBojView = cc.GameObjMgr.getMyObjView();\r\n    },\r\n    getAnglePosition:function(r,angle)\r\n    {\r\n        return cc.p(r * Math.cos(angle),r * Math.sin(angle));\r\n    },\r\n    onTouchBegan:function(event)\r\n    {      \r\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());\r\n        // 得到摇杆与触屏点所形成的角度\r\n        var pvecDes = cc.pSub(touchPos,this.stickBGPosition);       \r\n        var angle = cc.pToAngle(pvecDes);\r\n        var dist = (this.stickBGPosition.x - touchPos.x) * (this.stickBGPosition.x - touchPos.x) +\r\n                    (this.stickBGPosition.y - touchPos.y) * (this.stickBGPosition.y - touchPos.y);\r\n            \r\n        var rad = this.stickBGR * this.stickBGR;\r\n        if(dist >= rad)\r\n        {\r\n            this.pStickCenter.setPosition(cc.pAdd(this.getAnglePosition(this.stickBGR,angle),this.stickBGPosition));\r\n        }else\r\n        {\r\n            this.pStickCenter.setPosition(touchPos);\r\n        }\r\n        this.m_fAngle = angle;\r\n        this.m_pArrow.active = true;\r\n        cc.log(\"this.m_fAngle begin+++   \" + this.m_fAngle)\r\n        this.updateArrow();\r\n    },\r\n\r\n    onTouchMoved:function(event)\r\n    {         \r\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());       \r\n         var pvecDes = cc.pSub(touchPos,this.stickBGPosition);\r\n        var angle = cc.pToAngle(pvecDes);\r\n        var dist = (this.stickBGPosition.x - touchPos.x) * (this.stickBGPosition.x - touchPos.x) +\r\n                   (this.stickBGPosition.y - touchPos.y) * (this.stickBGPosition.y - touchPos.y);\r\n            \r\n        var rad = this.stickBGR * this.stickBGR;\r\n        if(dist >= rad)\r\n        {\r\n            this.pStickCenter.setPosition(cc.pAdd(this.getAnglePosition(this.stickBGR,angle),this.stickBGPosition));\r\n\r\n        }else\r\n        {\r\n            this.pStickCenter.setPosition(touchPos);\r\n        }\r\n\r\n        this.m_fAngle = angle;\r\n        cc.log(\"this.m_fAngle move+++   \" + this.m_fAngle);\r\n        this.updateArrow();\r\n        if(this.m_pMyBojView != null)\r\n        {\r\n            var eState = this.m_pMyBojView.m_objlogic.m_objState;\r\n            if(eState != eObjState.eObjWalk)\r\n            {\r\n                var pMSg = cc.MsgMgr.CreateMsgByID(10004);\r\n                pMSg.objLogicID = this.m_pMyBojView.m_iObjId;\r\n                pMSg.ObjState = eObjState.eObjWalk;       \r\n                cc.MsgMgr.sendMsgToServer(10004,pMSg);\r\n            }           \r\n        }        \r\n\r\n    },\r\n\r\n    onTouchEnded:function(event)\r\n    {\r\n       \r\n        var touchPos = this.node.convertToNodeSpaceAR(event.getLocation());       \r\n        this.pStickCenter.stopAllActions();\r\n        this.pStickCenter.runAction(cc.moveTo(0.08, this.stickBGPosition));\r\n        //this.m_fAngle = 0.0;\r\n        this.m_pArrow.active = false;      \r\n\r\n         var pMSg = cc.MsgMgr.CreateMsgByID(10004);\r\n         pMSg.objLogicID = this.m_pMyBojView.m_iObjId;\r\n         pMSg.ObjState = eObjState.eObjStand;       \r\n         cc.MsgMgr.sendMsgToServer(10004,pMSg);\r\n\r\n    },\r\n\r\n    onTouchCancelled:function(event)\r\n    {\r\n        //cc.log(\"++++++++++++onTouchCancelled+++++++++\");\r\n        this.onTouchEnded(event);\r\n    },\r\n\r\n    updateArrow:function()\r\n    {\r\n        if(this.m_pArrow)\r\n        {\r\n            this.m_pArrow.setPosition(cc.pAdd(this.getAnglePosition(this.stickBGR,this.m_fAngle),this.stickBGPosition));\r\n            this.m_pArrow.rotation = (-this.m_fAngle / Math.PI * 180);\r\n        }\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.m_pMyBojView == null)\r\n        {\r\n            this.m_pMyBojView = cc.GameObjMgr.getMyObjView();\r\n        }\r\n        if(this.m_pMyBojView == null)\r\n        {\r\n            return;\r\n        }\r\n        var nowAngle = this.m_fAngle.toFixed(2);\r\n        if(this.m_fOldAngle != nowAngle)\r\n        {\r\n            this.m_fOldAngle = nowAngle;            \r\n            var pMSg = cc.MsgMgr.CreateMsgByID(10003);\r\n            pMSg.objLogicID = this.m_pMyBojView.m_iObjId;\r\n            pMSg.fDir = this.m_fOldAngle;       \r\n            cc.MsgMgr.sendMsgToServer(10003,pMSg);\r\n        }      \r\n    },\r\n});\r\n"]}