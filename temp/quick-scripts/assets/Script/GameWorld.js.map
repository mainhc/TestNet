{"version":3,"sources":["GameWorld.js"],"names":["cGameObjMgr","require","GameObjMgr","cObjIDMgr","ObjIDMgr","cc","Class","extends","Component","properties","m_pMap","m_startPos","onLoad","node","getChildByName","initGameObjMgr","pMSg","MsgMgr","CreateMsgByID","myClientID","PlayerInfo","getMyPlayerID","sendMsgToServer","start","pCloseNetButton","on","Node","EventType","TOUCH_START","touchCloseNet","initMapPos","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded","TOUCH_CANCEL","onTouchCancelled","onDestroy","Net","GameInit","TableMgr","winsize","director","getWinSize","setPosition","width","height","event","touchPos","convertToNodeSpaceAR","getLocation","pDesPos","log","update","dt","myPos","getMyObjPos","x","y","pObjNum","pObjLabel","getComponent","Label","iNum","getObjNum","string"],"mappings":"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","file":"GameWorld.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\r\n\r\nvar cGameObjMgr = require(\"GameObjMgr\").GameObjMgr;\r\nvar cObjIDMgr = require(\"ObjIDMgr\").ObjIDMgr;\r\n\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n  \r\n        // defaults, set visually when attaching this script to the Canvas\r\n        m_pMap:null,\r\n        m_startPos:null,         \r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {       \r\n        \r\n       \r\n        this.m_pMap = this.node.getChildByName(\"Map\");  \r\n        if(cc.GameObjMgr == null)\r\n        {\r\n            cc.GameObjMgr = new cGameObjMgr;\r\n            cc.GameObjMgr.initGameObjMgr(this.m_pMap);\r\n        }\r\n\r\n        if(cc.ObjIDMgr == null)\r\n        {\r\n            cc.ObjIDMgr = new cObjIDMgr;\r\n        }\r\n        \r\n         var pMSg = cc.MsgMgr.CreateMsgByID(200001);\r\n         pMSg.myClientID = cc.PlayerInfo.getMyPlayerID();\r\n         cc.MsgMgr.sendMsgToServer(200001,pMSg);\r\n \r\n    },\r\n\r\n    start:function()\r\n    {\r\n        var pCloseNetButton = this.node.getChildByName(\"button\");\r\n        if(pCloseNetButton != null)\r\n        {\r\n            pCloseNetButton.on(cc.Node.EventType.TOUCH_START, this.touchCloseNet,this);\r\n        }      \r\n\r\n        this.initMapPos();\r\n        this.m_pMap.on(cc.Node.EventType.TOUCH_START, this.onTouchBegan,this);\r\n        this.m_pMap.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMoved,this);\r\n        this.m_pMap.on(cc.Node.EventType.TOUCH_END, this.onTouchEnded,this);\r\n        this.m_pMap.on(cc.Node.EventType.TOUCH_CANCEL, this.onTouchCancelled,this);    \r\n    },\r\n\r\n    onDestroy:function()\r\n    {\r\n        cc.Net = null;\r\n        cc.MsgMgr = null;\r\n        cc.GameInit = null;\r\n        cc.TableMgr = null;\r\n        cc.GameObjMgr = null;\r\n        cc.ObjIDMgr = null;\r\n    },\r\n\r\n\r\n\r\n    initMapPos()\r\n    {\r\n        var winsize = cc.director.getWinSize();\r\n        this.m_pMap.setPosition(-winsize.width/2,-winsize.height/2);\r\n    },  \r\n\r\n    onTouchBegan:function(event)\r\n    {     \r\n        //var touchPos = this.m_pMap.convertToNodeSpaceAR(event.getLocation());\r\n       // this.m_startPos = touchPos;\r\n        //cc.log(\"onTouchBegan\" + \"  \"+touchPos.x+ \"  \"+touchPos.y);      \r\n\r\n    },\r\n\r\n    onTouchMoved:function(event)\r\n    {\r\n       \r\n        var touchPos = this.m_pMap.convertToNodeSpaceAR(event.getLocation());\r\n   \r\n        // var touchStartPos = this.m_startPos;\r\n        // var movePos = cc.pSub(touchPos,touchStartPos);\r\n        // var pBeginPos = this.m_pMap.getPosition();\r\n        // var pDesPos = cc.pAdd(pBeginPos,movePos);\r\n        this.m_pMap.setPosition(pDesPos);\r\n        //cc.log(\"onTouchMoved\" + \"  \"+touchPos.x+ \"  \"+touchPos.y);       \r\n\r\n    },\r\n\r\n    onTouchEnded:function(event)\r\n    {\r\n       \r\n\r\n    },\r\n\r\n    onTouchCancelled:function(event)\r\n    {\r\n        cc.log(\"++++++++++++onTouchCancelled+++++++++\");\r\n        this.onTouchEnded(event);\r\n    },\r\n\r\n    touchCloseNet:function()\r\n    {\r\n        // var pMSg = cc.MsgMgr.CreateMsgByID(10001);\r\n        // pMSg.id = 1000003;\r\n        // pMSg.name = \"hahahaer\";\r\n        // pMSg.enterTime = 222222;\r\n        // cc.MsgMgr.sendMsgToServer(10001,pMSg);\r\n       // cc.Net.CloseNet();\r\n      \r\n    },\r\n\r\n    // called every frame\r\n    update: function (dt) {\r\n        if(cc.GameObjMgr != null)\r\n        {       \r\n            var myPos = cc.GameObjMgr.getMyObjPos();\r\n            if(myPos.x !=0 && myPos.y != 0)\r\n            {\r\n                 var winsize = cc.director.getWinSize();\r\n                // cc.log(\"myPos ++  \" + myPos.x +\"  \" + myPos.y);\r\n                 this.m_pMap.setPosition(-myPos.x,-myPos.y);\r\n            }\r\n            //显示场上单位数\r\n            var pObjNum = this.node.getChildByName(\"ObjNum\");\r\n            var pObjLabel = pObjNum.getComponent(cc.Label);\r\n            var iNum = cc.GameObjMgr.getObjNum();\r\n            pObjLabel.string = iNum;            \r\n        }     \r\n        \r\n    },   \r\n\r\n});\r\n"]}